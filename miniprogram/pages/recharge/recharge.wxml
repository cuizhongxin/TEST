<!--pages/recharge/recharge.wxml-->
<view class="page-container">
  <!-- 顶部用户信息 -->
  <view class="user-header">
    <view class="user-info">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/logo.png'}}" mode="aspectFill"></image>
      <view class="user-detail">
        <text class="nickname">{{userInfo.nickName || '主公'}}</text>
        <text class="vip-level" wx:if="{{vipLevel > 0}}">VIP{{vipLevel}}</text>
      </view>
    </view>
    <view class="balance-info">
      <view class="balance-item">
        <text class="balance-label">黄金</text>
        <text class="balance-value gold">{{gold}}</text>
      </view>
      <view class="balance-item">
        <text class="balance-label">钻石</text>
        <text class="balance-value diamond">{{diamond}}</text>
      </view>
    </view>
  </view>

  <!-- 充值商品列表 -->
  <view class="products-section">
    <view class="section-title">💰 充值套餐</view>
    <view class="products-grid">
      <view class="product-card {{selectedProduct && selectedProduct.id === item.id ? 'selected' : ''}} {{item.hot ? 'hot' : ''}}"
            wx:for="{{products}}" wx:key="id"
            data-product="{{item}}"
            bindtap="selectProduct">
        <view class="hot-tag" wx:if="{{item.hot}}">热销</view>
        <view class="product-icon">{{item.icon}}</view>
        <view class="product-name">{{item.name}}</view>
        <view class="product-content">
          <text class="gold-amount">{{item.goldAmount}}黄金</text>
          <text class="diamond-amount">+{{item.diamondAmount}}钻石</text>
        </view>
        <view class="product-price">¥{{item.price / 100}}</view>
        <view class="first-double" wx:if="{{!hasRecharged && index === 0}}">首充双倍</view>
      </view>
    </view>
  </view>

  <!-- 支付方式选择 -->
  <view class="payment-section">
    <view class="section-title">💳 支付方式</view>
    <view class="payment-methods">
      <view class="payment-item {{paymentMethod === 'WECHAT' ? 'selected' : ''}}" 
            bindtap="selectPayment" data-method="WECHAT">
        <view class="payment-icon wechat">💚</view>
        <text class="payment-name">微信支付</text>
        <view class="check-mark" wx:if="{{paymentMethod === 'WECHAT'}}">✓</view>
      </view>
      <view class="payment-item {{paymentMethod === 'ALIPAY' ? 'selected' : ''}}" 
            bindtap="selectPayment" data-method="ALIPAY">
        <view class="payment-icon alipay">💙</view>
        <text class="payment-name">支付宝</text>
        <view class="check-mark" wx:if="{{paymentMethod === 'ALIPAY'}}">✓</view>
      </view>
      <view class="payment-item {{paymentMethod === 'UNIONPAY' ? 'selected' : ''}}" 
            bindtap="selectPayment" data-method="UNIONPAY">
        <view class="payment-icon unionpay">🏦</view>
        <text class="payment-name">银联支付</text>
        <view class="check-mark" wx:if="{{paymentMethod === 'UNIONPAY'}}">✓</view>
      </view>
    </view>
  </view>

  <!-- 充值说明 -->
  <view class="notice-section">
    <view class="section-title">📋 充值说明</view>
    <view class="notice-content">
      <text>1. 充值后黄金和钻石将即时到账</text>
      <text>2. 首次充值可获得双倍奖励</text>
      <text>3. 充值满一定金额可提升VIP等级</text>
      <text>4. 如有问题请联系客服</text>
    </view>
  </view>

  <!-- 底部支付按钮 -->
  <view class="bottom-bar">
    <view class="order-summary" wx:if="{{selectedProduct}}">
      <text class="summary-label">应付金额：</text>
      <text class="summary-price">¥{{selectedProduct.price / 100}}</text>
    </view>
    <button class="pay-btn {{!selectedProduct || !paymentMethod ? 'disabled' : ''}}" 
            bindtap="handlePay"
            disabled="{{!selectedProduct || !paymentMethod || paying}}">
      {{paying ? '支付中...' : '立即支付'}}
    </button>
  </view>

  <!-- 充值记录入口 -->
  <view class="history-entry" bindtap="viewHistory">
    <text>📜 充值记录</text>
    <text class="arrow">›</text>
  </view>
</view>
