<!--pages/training/training.wxml-->
<view class="page-container">
  <view class="header">
    <text class="title">è®­ç»ƒåœº</text>
  </view>

  <!-- èµ„æºæ˜¾ç¤º -->
  <view class="resource-bar">
    <view class="resource-item">
      <text class="res-icon">ğŸš</text>
      <text class="res-name">ç²®é£Ÿ</text>
      <text class="res-value">{{food}}</text>
    </view>
    <view class="resource-item">
      <text class="res-icon">â­</text>
      <text class="res-name">ä¸»å…¬ç»éªŒ</text>
      <text class="res-value">{{lordExp}}/{{lordMaxExp}}</text>
    </view>
  </view>

  <!-- è®­ç»ƒæ¨¡å¼é€‰æ‹© -->
  <view class="mode-section">
    <text class="section-title">é€‰æ‹©è®­ç»ƒæ¨¡å¼</text>
    <view class="mode-tabs">
      <view class="mode-tab {{currentMode === 'lord' ? 'active' : ''}}" bindtap="switchMode" data-mode="lord">
        <text class="mode-icon">ğŸ‘‘</text>
        <text class="mode-name">ä¸»å…¬ä¿®ç‚¼</text>
        <text class="mode-desc">å¤šä¸»å…¬ç»éªŒï¼Œå°‘æ­¦å°†ç»éªŒ</text>
      </view>
      <view class="mode-tab {{currentMode === 'general' ? 'active' : ''}}" bindtap="switchMode" data-mode="general">
        <text class="mode-icon">âš”ï¸</text>
        <text class="mode-name">æ­¦å°†ç‰¹è®­</text>
        <text class="mode-desc">å¤šæ­¦å°†ç»éªŒï¼Œå°‘ä¸»å…¬ç»éªŒ</text>
      </view>
    </view>
  </view>

  <!-- ç²®é£Ÿç­‰çº§é€‰æ‹© -->
  <view class="food-section">
    <text class="section-title">é€‰æ‹©ç²®é£Ÿç­‰çº§</text>
    <view class="food-list">
      <view class="food-card {{item.level === selectedFood ? 'active' : ''}}" 
            wx:for="{{foodTypes}}" wx:key="level"
            bindtap="selectFood" data-level="{{item.level}}">
        <view class="food-header">
          <text class="food-icon">{{item.icon}}</text>
          <text class="food-name">{{item.name}}</text>
        </view>
        <view class="food-cost">
          <text>æ¶ˆè€—: {{item.cost}} ç²®é£Ÿ</text>
        </view>
        <view class="food-reward">
          <block wx:if="{{currentMode === 'lord'}}">
            <text class="reward-main">ä¸»å…¬ +{{item.lordExpMain}}</text>
            <text class="reward-sub">æ­¦å°† +{{item.generalExpSub}}</text>
          </block>
          <block wx:else>
            <text class="reward-main">æ­¦å°† +{{item.generalExpMain}}</text>
            <text class="reward-sub">ä¸»å…¬ +{{item.lordExpSub}}</text>
          </block>
        </view>
      </view>
    </view>
  </view>

  <!-- æ­¦å°†é€‰æ‹©ï¼ˆä»…æ­¦å°†ç‰¹è®­æ¨¡å¼ï¼‰ -->
  <view class="general-section" wx:if="{{currentMode === 'general'}}">
    <text class="section-title">é€‰æ‹©è®­ç»ƒæ­¦å°†</text>
    <scroll-view class="general-scroll" scroll-x>
      <view class="general-item {{currentGeneralId === item.id ? 'active' : ''}}"
            wx:for="{{generals}}" wx:key="id"
            bindtap="selectGeneral" data-id="{{item.id}}">
        <view class="general-avatar">
          <image src="{{item.avatar || '/images/logo.png'}}" mode="aspectFill"></image>
        </view>
        <text class="general-name">{{item.name}}</text>
        <text class="general-level">Lv.{{item.level || 1}}</text>
        <view class="exp-bar">
          <view class="exp-fill" style="width: {{(item.exp / item.maxExp) * 100}}%"></view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- è®­ç»ƒæ¬¡æ•° -->
  <view class="count-section">
    <text class="section-title">è®­ç»ƒæ¬¡æ•°</text>
    <view class="count-control">
      <view class="count-btn" bindtap="decreaseCount">-</view>
      <text class="count-value">{{trainCount}}</text>
      <view class="count-btn" bindtap="increaseCount">+</view>
      <view class="count-btn max" bindtap="maxCount">æœ€å¤§</view>
    </view>
    <view class="cost-preview">
      <text>é¢„è®¡æ¶ˆè€—: {{totalCost}} ç²®é£Ÿ</text>
    </view>
  </view>

  <!-- è®­ç»ƒæŒ‰é’® -->
  <view class="action-section">
    <button class="train-btn {{canTrain ? '' : 'disabled'}}" bindtap="startTraining">
      å¼€å§‹è®­ç»ƒ
    </button>
  </view>

  <!-- è®­ç»ƒç»“æœå¼¹çª— -->
  <view class="result-modal" wx:if="{{showResult}}">
    <view class="result-content">
      <text class="result-title">ğŸ‰ è®­ç»ƒå®Œæˆï¼</text>
      <view class="result-info">
        <text class="result-item" wx:if="{{resultLordExp > 0}}">ä¸»å…¬ç»éªŒ +{{resultLordExp}}</text>
        <text class="result-item" wx:if="{{resultGeneralExp > 0}}">æ­¦å°†ç»éªŒ +{{resultGeneralExp}}</text>
        <text class="result-item levelup" wx:if="{{levelUp}}">ğŸ†™ ç­‰çº§æå‡ï¼</text>
      </view>
      <button class="result-btn" bindtap="closeResult">ç¡®å®š</button>
    </view>
  </view>
</view>
