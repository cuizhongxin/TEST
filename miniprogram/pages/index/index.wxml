<!--pages/index/index.wxml-->
<view class="game-container">
  <!-- é¡¶éƒ¨èµ„æºæ  -->
  <view class="top-bar">
    <view class="user-section">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/logo.png'}}" mode="aspectFill"></image>
      <view class="user-detail">
        <text class="nickname">{{userInfo.nickName || 'ä¸»å…¬'}}</text>
        <text class="level">{{level}}çº§</text>
      </view>
      <view class="exp-bar">
        <view class="exp-fill" style="width: {{expPercent}}%"></view>
        <text class="exp-text">{{currentExp}}/{{nextLevelExp}}</text>
      </view>
    </view>
    <view class="resource-grid">
      <view class="resource-item">
        <text class="res-label">çˆµä½</text>
        <text class="res-value">{{rank}}</text>
      </view>
      <view class="resource-item">
        <text class="res-label">å£°æœ›</text>
        <text class="res-value">{{fame}}</text>
      </view>
      <view class="resource-item">
        <text class="res-label">å°†é¢†</text>
        <text class="res-value">{{generalCount}}</text>
      </view>
      <view class="resource-item">
        <text class="res-label">æ­¦å°†</text>
        <text class="res-value">{{maxGeneral}}</text>
      </view>
      <view class="resource-item">
        <text class="res-label">é»„é‡‘</text>
        <text class="res-value gold">{{gold}}</text>
      </view>
      <view class="resource-item">
        <text class="res-label">ç™½é“¶</text>
        <text class="res-value silver">{{silver}}</text>
      </view>
      <view class="resource-item">
        <text class="res-label">ç²¾åŠ›</text>
        <text class="res-value">{{stamina}}</text>
      </view>
      <view class="resource-item">
        <text class="res-label">å°†ä»¤</text>
        <text class="res-value">{{generalOrder}}</text>
      </view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒº - å¯æ»šåŠ¨ -->
  <view class="main-content">
    <!-- å·¦ä¾§æ‚¬æµ®æ  -->
    <view class="left-sidebar">
      <view class="sidebar-icon" wx:for="{{leftIcons}}" wx:key="id" 
            data-name="{{item.name}}" bindtap="onLeftIconTap">
        <text class="icon-emoji">{{item.icon}}</text>
        <text class="icon-label">{{item.label}}</text>
      </view>
    </view>

    <!-- ä¸­é—´ä¸»åŒºåŸŸ - å¯æ»šåŠ¨ -->
    <scroll-view class="center-area" scroll-y enhanced show-scrollbar="{{false}}">
      <!-- æˆ‘çš„æ­¦å°†ï¼ˆæœ€å¤šæ˜¾ç¤º6ä¸ªï¼‰ -->
      <view class="generals-bar-inner">
        <view class="generals-title">æ­¦å°†({{generalCount}})</view>
        <view class="generals-row">
          <view class="general-card-mini" wx:for="{{displayGenerals}}" wx:key="index" 
                wx:if="{{item}}" data-id="{{item.id}}" bindtap="goToCharacterDetail">
            <image class="card-avatar-mini" src="{{item.avatar || userInfo.avatarUrl}}" 
                   style="border-color: {{item.quality.color || '#8b6914'}}" mode="aspectFill"></image>
            <text class="card-name-mini">{{item.name}}</text>
          </view>
          <view class="general-card-mini add-card-mini" bindtap="goToRecruit" wx:if="{{generalCount < 6}}">
            <view class="add-icon-mini">+</view>
            <text class="card-name-mini">æ‹›å‹Ÿ</text>
          </view>
        </view>
      </view>

      <!-- åŠŸèƒ½æŒ‰é’®åŒº -->
      <view class="function-section">
        <view class="function-grid-full">
          <view class="func-row">
            <view class="func-btn" bindtap="goToEquipment">
              <text class="func-text">è£…å¤‡</text>
            </view>
            <view class="func-btn" bindtap="goToFormation">
              <text class="func-text">é˜µå‹</text>
            </view>
            <view class="func-btn" bindtap="goToTactics">
              <text class="func-text">å…µæ³•</text>
            </view>
          </view>
          <view class="func-row">
            <view class="func-btn" bindtap="goToTrain">
              <text class="func-text">è®­ç»ƒ</text>
            </view>
            <view class="func-btn" bindtap="goToEnhance">
              <text class="func-text">ç²¾ç‚¼</text>
            </view>
            <view class="func-btn" bindtap="goToSoldier">
              <text class="func-text">å£«å…µ</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠŸèƒ½å›¾æ ‡æ  -->
      <view class="func-icons-section">
        <view class="func-icons">
          <view class="icon-item" bindtap="goToRecruit">
            <view class="icon-img">ğŸº</view>
            <text class="icon-name">é…’é¦†</text>
          </view>
          <view class="icon-item" bindtap="goToProduction">
            <view class="icon-img">ğŸ­</view>
            <text class="icon-name">ç”Ÿäº§</text>
          </view>
          <view class="icon-item" bindtap="goToSecretRealm">
            <view class="icon-img">ğŸ’</view>
            <text class="icon-name">å®åº“</text>
          </view>
          <view class="icon-item" bindtap="goToDungeon">
            <view class="icon-img">âš”ï¸</view>
            <text class="icon-name">æˆ˜å½¹</text>
          </view>
          <view class="icon-item" bindtap="goToWarehouse">
            <view class="icon-img">ğŸ“¦</view>
            <text class="icon-name">ä»“åº“</text>
          </view>
          <view class="icon-item" bindtap="goToAlliance">
            <view class="icon-img">ğŸ°</view>
            <text class="icon-name">è”ç›Ÿ</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- å³ä¾§æ‚¬æµ®æ  -->
    <view class="right-sidebar">
      <view class="sidebar-icon" wx:for="{{rightIcons}}" wx:key="id" 
            data-name="{{item.name}}" bindtap="onRightIconTap">
        <text class="icon-emoji">{{item.icon}}</text>
        <text class="icon-label">{{item.label}}</text>
      </view>
    </view>
  </view>

  <!-- èŠå¤©æ  -->
  <view class="chat-bar" bindtap="openChatPage">
    <text class="chat-label">èŠå¤©</text>
    <text class="chat-text">ã€ç³»ç»Ÿã€‘{{lastMessage ? lastMessage.text : 'æ¬¢è¿æ¥åˆ°ä¸‰å›½å¿—æˆ˜å½¹ï¼'}}</text>
  </view>
</view>
