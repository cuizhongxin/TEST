<!--pages/index/index.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="top-status">
    <view class="player-section">
      <!-- å¤´åƒåŒºåŸŸ -->
      <view class="avatar-area">
        <view class="player-avatar">
          <image src="{{userInfo.avatarUrl || '/images/logo.png'}}" mode="aspectFill" class="avatar-img"></image>
        </view>
        <view class="level-badge">{{level}}çº§</view>
        <view class="mini-exp-bar">
          <view class="mini-exp-fill" style="width: {{expPercent}}%"></view>
        </view>
      </view>
      <!-- èµ„æºåŒºåŸŸ -->
      <view class="resource-area">
        <view class="info-line">
          <text class="player-name">{{userInfo.nickName || 'ä¸»å…¬'}}</text>
          <text class="stat">å®˜ä½ {{rank}}</text>
          <text class="stat">å£°æœ› {{fame}}</text>
          <text class="stat">æ­¦å°† {{generalCount}}/{{maxGeneral}}</text>
        </view>
        <view class="resource-row">
          <view class="resource-item">
            <text class="res-label">é»„é‡‘</text>
            <text class="res-value gold">{{gold}}</text>
          </view>
          <view class="resource-item">
            <text class="res-label">ç™½é“¶</text>
            <text class="res-value silver">{{silver}}</text>
          </view>
          <view class="resource-item">
            <text class="res-label">ç²¾åŠ›</text>
            <text class="res-value">{{stamina}}</text>
          </view>
          <view class="resource-item">
            <text class="res-label">å…µç¬¦</text>
            <text class="res-value">{{generalOrder}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- å·¦ä¾§æ‚¬æµ®å›¾æ ‡ -->
    <view class="side-panel left">
      <view class="side-btn" wx:for="{{leftIcons}}" wx:key="id" bindtap="onLeftIconTap" data-name="{{item.name}}">
        <text class="side-icon">{{item.icon}}</text>
        <text class="side-label">{{item.label}}</text>
      </view>
    </view>

    <!-- å³ä¾§æ‚¬æµ®å›¾æ ‡ -->
    <view class="side-panel right">
      <view class="side-btn" wx:for="{{rightIcons}}" wx:key="id" bindtap="onRightIconTap" data-name="{{item.name}}">
        <text class="side-icon">{{item.icon}}</text>
        <text class="side-label">{{item.label}}</text>
      </view>
    </view>

    <!-- ä¸­é—´å†…å®¹åŒºåŸŸ -->
    <view class="center-scroll">
      <!-- æ­¦å°†æ  -->
      <view class="generals-row">
        <view class="general-slot" wx:for="{{6}}" wx:key="index" bindtap="onGeneralTap" data-index="{{index}}">
          <block wx:if="{{displayGenerals[index]}}">
            <view class="general-avatar">
              <image src="{{displayGenerals[index].avatar || '/images/logo.png'}}" mode="aspectFill"></image>
            </view>
          </block>
          <block wx:else>
            <view class="general-avatar empty">+</view>
          </block>
        </view>
      </view>

      <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
      <view class="function-area">
        <view class="func-row">
          <view class="scroll-btn" bindtap="goToEquipment">
            <text class="scroll-text">è£…å¤‡</text>
          </view>
          <view class="scroll-btn" bindtap="goToFormation">
            <text class="scroll-text">é˜µå‹</text>
          </view>
          <view class="scroll-btn" bindtap="goToTactics">
            <text class="scroll-text">å…µæ³•</text>
          </view>
        </view>
        <view class="func-row">
          <view class="scroll-btn" bindtap="goToTraining">
            <text class="scroll-text">è®­ç»ƒ</text>
          </view>
          <view class="scroll-btn" bindtap="goToEnhance">
            <text class="scroll-text">å¼ºåŒ–</text>
          </view>
          <view class="scroll-btn" bindtap="goToRecruit">
            <text class="scroll-text">å£«å…µ</text>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨åŠŸèƒ½å›¾æ ‡ -->
      <view class="bottom-icons">
        <view class="bottom-btn" bindtap="goToCharacter">
          <text class="bottom-icon">ğŸ‘¥</text>
          <text class="bottom-label">å°†</text>
        </view>
        <view class="bottom-btn" bindtap="goToCraft">
          <text class="bottom-icon">ğŸ”¨</text>
          <text class="bottom-label">ç²¾ç»ƒ</text>
        </view>
        <view class="bottom-btn" bindtap="goToSecretRealm">
          <text class="bottom-icon">ğŸ’</text>
          <text class="bottom-label">å®ç‰©</text>
        </view>
        <view class="bottom-btn" bindtap="goToDungeon">
          <text class="bottom-icon">ğŸ°</text>
          <text class="bottom-label">æˆ˜å½¹</text>
        </view>
        <view class="bottom-btn" bindtap="goToWarehouse">
          <text class="bottom-icon">ğŸ“¦</text>
          <text class="bottom-label">ä»“åº“</text>
        </view>
        <view class="bottom-btn" bindtap="goToAlliance">
          <text class="bottom-icon">ğŸ›ï¸</text>
          <text class="bottom-label">è”ç›Ÿ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨èŠå¤©æ  -->
  <view class="chat-bar" bindtap="openChatPage">
    <text class="chat-label">èŠå¤©</text>
    <view class="chat-content">
      <text class="chat-msg" wx:if="{{lastMessage}}">ã€{{lastMessage.user}}ã€‘{{lastMessage.text}}</text>
      <text class="chat-msg" wx:else>ã€ç³»ç»Ÿã€‘æ¬¢è¿æ¥åˆ°ä¸‰å›½å¿—Â·æˆ˜å½¹ï¼</text>
    </view>
  </view>
</view>
