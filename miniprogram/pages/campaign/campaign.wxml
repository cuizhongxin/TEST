<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">â€¹</text>
    </view>
    <text class="title">æˆ˜å½¹</text>
    <view class="placeholder"></view>
  </view>

  <!-- æˆ˜å½¹åˆ—è¡¨ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰ -->
  <scroll-view class="campaign-list" scroll-x="true">
    <view wx:if="{{loading}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:else class="campaign-grid">
      <view 
        wx:for="{{campaigns}}" 
        wx:key="id" 
        class="campaign-card {{!item.unlocked ? 'locked' : ''}}"
        bindtap="selectCampaign"
        data-campaign="{{item}}"
      >
        <!-- æˆ˜å½¹èƒŒæ™¯å’Œæ ‡é¢˜ -->
        <view class="campaign-banner">
          <image class="campaign-bg" src="{{item.icon || '/images/campaign/default.png'}}" mode="aspectFill"></image>
          <view class="campaign-overlay"></view>
          <view class="campaign-info">
            <text class="campaign-name">{{item.name}}</text>
            <view class="daily-limit">
              <text>æ—¥æ¬¡æ•°: {{item.dailyLimit - item.todayCount}}/{{item.dailyLimit}}</text>
            </view>
          </view>
          <!-- é”å®šå›¾æ ‡ -->
          <view wx:if="{{!item.unlocked}}" class="lock-overlay">
            <text class="lock-icon">ğŸ”’</text>
            <text class="lock-text">{{item.requiredLevel}}çº§è§£é”</text>
          </view>
          <!-- è¿›è¡Œä¸­/æš‚åœæ ‡è¯† -->
          <view wx:if="{{item.status === 'IN_PROGRESS'}}" class="status-tag progress">
            <text>è¿›è¡Œä¸­</text>
          </view>
          <view wx:elif="{{item.status === 'PAUSED'}}" class="status-tag paused">
            <text>å·²æš‚åœ</text>
          </view>
          <!-- å¯æ‰«è¡æ ‡è¯† -->
          <view wx:if="{{item.canSweep}}" class="sweep-tag">
            <text>å¯æ‰«è¡</text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- æˆ˜å½¹è¯¦æƒ…å¼¹çª— -->
  <view wx:if="{{showDetail}}" class="detail-modal" bindtap="closeDetail">
    <view class="detail-content" catchtap="preventClose">
      <!-- è¯¦æƒ…å¤´éƒ¨ -->
      <view class="detail-header">
        <text class="detail-title">{{selectedCampaign.name}}</text>
        <view class="close-btn" bindtap="closeDetail">Ã—</view>
      </view>

      <!-- æˆ˜å½¹ä¿¡æ¯ -->
      <view class="detail-body">
        <view class="info-row">
          <text class="info-label">æ•Œäººç­‰çº§:</text>
          <text class="info-value">{{selectedCampaign.enemyLevelMin}}-{{selectedCampaign.enemyLevelMax}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">æˆ˜æ–—ç»éªŒ:</text>
          <text class="info-value highlight">{{selectedCampaign.expRewardMin}}-{{selectedCampaign.expRewardMax}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">å…³å¡æ•°é‡:</text>
          <text class="info-value">{{selectedCampaign.stageCount}}å…³</text>
        </view>
        <view class="info-row">
          <text class="info-label">ç²¾åŠ›æ¶ˆè€—:</text>
          <text class="info-value">{{selectedCampaign.staminaCost}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">é€šå…³è¿›åº¦:</text>
          <text class="info-value">{{selectedCampaign.maxClearedStage}}/{{selectedCampaign.stageCount}}</text>
        </view>

        <!-- æ‰è½é¢„è§ˆ -->
        <view class="drop-section">
          <text class="drop-title">æ‰è½è£…å¤‡</text>
          <view class="drop-list">
            <view wx:for="{{selectedCampaign.dropPreviews}}" wx:key="index" class="drop-item {{item.quality === 'ä¼˜ç§€' ? 'quality-excellent' : item.quality === 'ç²¾è‰¯' ? 'quality-rare' : item.quality === 'å²è¯—' ? 'quality-epic' : item.quality === 'ä¼ è¯´' ? 'quality-legendary' : ''}}">
              <image class="drop-icon" src="{{item.icon || '/images/equip/default.png'}}" mode="aspectFit"></image>
              <text class="drop-name">{{item.name}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="detail-footer">
        <view wx:if="{{selectedCampaign.status === 'IN_PROGRESS' || selectedCampaign.status === 'PAUSED'}}" 
              class="btn btn-primary" bindtap="enterCampaign">
          <text>ç»§ç»­æˆ˜å½¹</text>
        </view>
        <view wx:elif="{{selectedCampaign.todayCount >= selectedCampaign.dailyLimit}}" 
              class="btn btn-disabled">
          <text>ä»Šæ—¥æ¬¡æ•°å·²ç”¨å®Œ</text>
        </view>
        <view wx:else class="btn btn-primary" bindtap="enterCampaign">
          <text>è¿›å…¥æˆ˜å½¹</text>
        </view>
        
        <view wx:if="{{selectedCampaign.canSweep && selectedCampaign.todayCount < selectedCampaign.dailyLimit}}" 
              class="btn btn-sweep" bindtap="startSweep">
          <text>å¼€å§‹æ‰«è¡</text>
        </view>
      </view>
    </view>
  </view>
</view>
