<!--pages/campaign/campaign.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨èµ„æºæ  -->
  <view class="top-bar">
    <view class="resource-item">
      <image class="resource-icon" src="/images/icons/stamina.png" mode="aspectFit"/>
      <text class="resource-value">ç²¾åŠ›: {{stamina}}</text>
    </view>
    <view class="resource-item">
      <image class="resource-icon" src="/images/icons/tiger.png" mode="aspectFit"/>
      <text class="resource-value">è™ç¬¦: {{tigerTalisman}}</text>
    </view>
  </view>

  <view class="main-content">
    <!-- å·¦ä¾§æˆ˜å½¹åˆ—è¡¨ -->
    <scroll-view class="campaign-list" scroll-y>
      <view class="campaign-item {{selectedCampaign && selectedCampaign.campaign.id === item.campaign.id ? 'selected' : ''}} {{!item.unlocked ? 'locked' : ''}}"
            wx:for="{{campaigns}}" 
            wx:key="index"
            data-index="{{index}}"
            bindtap="selectCampaign">
        <view class="campaign-bg">
          <view class="campaign-name">{{item.campaign.name}}</view>
          <view class="campaign-limit">
            <text class="limit-icon">â±</text>
            <text>æ—¥æ¬¡æ•°: {{item.todayRemaining}}/{{item.campaign.dailyLimit}}</text>
          </view>
          <view class="lock-mask" wx:if="{{!item.unlocked}}">
            <text class="lock-text">ğŸ”’ éœ€è¦ç­‰çº§ {{item.campaign.requiredLevel}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- å³ä¾§æˆ˜å½¹è¯¦æƒ… -->
    <view class="campaign-detail" wx:if="{{selectedCampaign}}">
      <view class="detail-header">
        <view class="detail-title">{{selectedCampaign.campaign.name}}</view>
        <view class="detail-subtitle">ç¬¬{{selectedCampaign.campaign.chapter}}ç« </view>
      </view>
      
      <view class="detail-info">
        <view class="info-row">
          <text class="info-label">æ•Œäººç­‰çº§:</text>
          <text class="info-value">{{selectedCampaign.campaign.minEnemyLevel}}-{{selectedCampaign.campaign.maxEnemyLevel}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">æˆ˜æ–—ç»éªŒ:</text>
          <text class="info-value highlight">{{selectedCampaign.campaign.minExp}}-{{selectedCampaign.campaign.maxExp}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">æ¶ˆè€—ç²¾åŠ›:</text>
          <text class="info-value">{{selectedCampaign.campaign.staminaCost}}/å…³</text>
        </view>
        <view class="info-row">
          <text class="info-label">å·²é€šå…³:</text>
          <text class="info-value">{{selectedCampaign.progress.maxClearedStage}}/{{selectedCampaign.campaign.stages.length}}å…³</text>
        </view>
      </view>

      <view class="drop-preview">
        <view class="drop-title">æ‰è½å¥–åŠ±</view>
        <view class="drop-items">
          <view class="drop-item" wx:for="{{selectedCampaign.campaign.dropRewards}}" wx:key="index">
            <view class="drop-icon-bg {{getQualityClass(item)}}">
              <text class="drop-icon">âš”</text>
            </view>
            <text class="drop-name">{{item}}</text>
          </view>
        </view>
      </view>

      <view class="action-buttons">
        <button class="btn-enter" 
                bindtap="enterCampaign"
                disabled="{{!selectedCampaign.unlocked || selectedCampaign.todayRemaining <= 0}}">
          {{selectedCampaign.progress.inProgress ? 'ç»§ç»­æˆ˜å½¹' : 'è¿›å…¥æˆ˜å½¹'}}
        </button>
        <button class="btn-sweep" 
                bindtap="showSweepModal"
                wx:if="{{selectedCampaign.progress.maxClearedStage > 0}}"
                disabled="{{tigerTalisman <= 0}}">
          å¼€å§‹æ‰«è¡
        </button>
      </view>
    </view>
  </view>

  <!-- è¿”å›æŒ‰é’® -->
  <view class="back-btn" bindtap="goBack">
    <text>è¿”å›</text>
  </view>
</view>

<!-- æ‰«è¡å¼¹çª— -->
<view class="modal-mask" wx:if="{{showSweepModal}}" bindtap="closeSweepModal">
  <view class="sweep-modal" catchtap="">
    <view class="modal-header">
      <text class="modal-title">æ‰«è¡è®¾ç½®</text>
      <view class="modal-close" bindtap="closeSweepModal">âœ•</view>
    </view>
    
    <view class="modal-body">
      <view class="sweep-info">
        <text>å½“å‰å…³æ•°: ç¬¬{{selectedCampaign.progress.maxClearedStage}}å…³</text>
      </view>
      <view class="sweep-tips">
        <text>â€¢ æ‰«è¡è¿‡ç¨‹ä¸­è‡ªåŠ¨æ¶ˆè€—ç™½é“¶è¡¥å……å…µåŠ›</text>
        <text>â€¢ æ‰«è¡è‡³æŒ‡å®šå…³æ•°æˆ–è€…æˆ˜æ–—å¤±è´¥åˆ™æ‰«è¡è‡ªåŠ¨åœæ­¢</text>
      </view>
      
      <view class="sweep-setting">
        <text class="setting-label">æ‰«è¡å®Œç¬¬</text>
        <view class="sweep-count">
          <button class="count-btn" bindtap="decreaseSweepTarget">-</button>
          <text class="count-value">{{sweepTarget}}</text>
          <button class="count-btn" bindtap="increaseSweepTarget">+</button>
        </view>
        <text class="setting-label">å…³åè‡ªåŠ¨ç»“æŸ</text>
      </view>
      
      <view class="sweep-cost">
        <text>æ¯æ¬¡æ‰«è¡éœ€è¦æ¶ˆè€—1æšè™ç¬¦</text>
        <text class="tiger-count">å‰©ä½™è™ç¬¦: {{tigerTalisman}}</text>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn-start-sweep" bindtap="startSweep">å¼€å§‹æ‰«è¡</button>
      <button class="btn-cancel" bindtap="closeSweepModal">è¿”å›</button>
    </view>
  </view>
</view>

<!-- æ‰«è¡ç»“æœå¼¹çª— -->
<view class="modal-mask" wx:if="{{showSweepResult}}" bindtap="closeSweepResult">
  <view class="result-modal" catchtap="">
    <view class="modal-header">
      <text class="modal-title">æ‰«è¡ç»“æœ</text>
    </view>
    
    <view class="modal-body">
      <view class="result-item">
        <text>é€šå…³å…³å¡: {{sweepResult.stagesCleared}}å…³</text>
      </view>
      <view class="result-item">
        <text>è·å¾—ç»éªŒ: {{sweepResult.totalExp}}</text>
      </view>
      <view class="result-item">
        <text>è·å¾—ç™½é“¶: {{sweepResult.totalSilver}}</text>
      </view>
      <view class="result-item">
        <text>æ¶ˆè€—è™ç¬¦: {{sweepResult.tigerTalismanUsed}}</text>
      </view>
      <view class="result-item">
        <text>æ¶ˆè€—ç™½é“¶(è¡¥å…µ): {{sweepResult.silverUsed}}</text>
      </view>
      <view class="result-item highlight">
        <text>{{sweepResult.stopReason}}</text>
      </view>
      
      <view class="drop-list" wx:if="{{sweepResult.allDrops.length > 0}}">
        <text class="drop-title">æ‰è½ç‰©å“</text>
        <view class="drops">
          <view class="drop-item" wx:for="{{sweepResult.allDrops}}" wx:key="index">
            <text>{{item.itemName}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn-confirm" bindtap="closeSweepResult">ç¡®å®š</button>
    </view>
  </view>
</view>
