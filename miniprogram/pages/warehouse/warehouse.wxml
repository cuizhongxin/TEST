<!--pages/warehouse/warehouse.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨æ  -->
  <view class="top-bar">
    <view class="back-btn" bindtap="goBack">â—€ è¿”å›</view>
    <view class="page-title">ğŸ“¦ ä»“åº“</view>
    <view class="resource-info">
      <text class="gold">ğŸª™ {{gold}}</text>
      <text class="silver">ğŸ¥ˆ {{silver}}</text>
    </view>
  </view>
  
  <!-- ä¸»å†…å®¹ -->
  <view class="main-content">
    <!-- å·¦ä¾§ï¼šæ ‡ç­¾å’Œæ“ä½œ -->
    <view class="left-panel">
      <!-- æ ‡ç­¾åˆ‡æ¢ -->
      <view class="tab-list">
        <view class="tab-item {{activeTab === 'equipment' ? 'active' : ''}}" bindtap="switchTab" data-tab="equipment">
          <text class="tab-icon">âš”ï¸</text>
          <text class="tab-name">è£…å¤‡</text>
        </view>
        <view class="tab-item {{activeTab === 'item' ? 'active' : ''}}" bindtap="switchTab" data-tab="item">
          <text class="tab-icon">ğŸ’</text>
          <text class="tab-name">ç‰©å“</text>
        </view>
      </view>
      
      <!-- å®¹é‡ä¿¡æ¯ -->
      <view class="capacity-info">
        <text class="capacity-label">å®¹é‡</text>
        <view class="capacity-bar">
          <view class="capacity-fill" style="width: {{activeTab === 'equipment' ? (equipmentInfo.used / equipmentInfo.capacity) * 100 : (itemInfo.used / itemInfo.capacity) * 100}}%"></view>
        </view>
        <text class="capacity-text">{{activeTab === 'equipment' ? equipmentInfo.used : itemInfo.used}}/{{activeTab === 'equipment' ? equipmentInfo.capacity : itemInfo.capacity}}</text>
      </view>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-list">
        <view class="action-btn expand" bindtap="expandStorage" data-type="{{activeTab}}" 
              wx:if="{{(activeTab === 'equipment' ? equipmentInfo.expandTimes : itemInfo.expandTimes) < 4}}">
          <text>æ‰©å……+100</text>
          <text class="cost">ğŸ’°{{activeTab === 'equipment' ? equipmentInfo.nextExpandCost : itemInfo.nextExpandCost}}</text>
        </view>
        <view class="action-btn disabled" wx:else>
          <text>å·²æ»¡</text>
        </view>
        
        <view class="action-btn {{batchMode ? 'active' : ''}}" bindtap="toggleBatchMode" wx:if="{{activeTab === 'equipment'}}">
          {{batchMode ? 'å–æ¶ˆ' : 'æ‰¹é‡'}}
        </view>
        
        <view class="action-btn sell" wx:if="{{batchMode && selectedEquipments.length > 0}}" bindtap="batchSell">
          å‡ºå”®({{selectedEquipments.length}})
        </view>
      </view>
      
      <!-- ç‰©å“ç­›é€‰ -->
      <view class="filter-list" wx:if="{{activeTab === 'item'}}">
        <view class="filter-item {{itemFilter === 'all' ? 'active' : ''}}" bindtap="setItemFilter" data-filter="all">å…¨éƒ¨</view>
        <view class="filter-item {{itemFilter === 'material' ? 'active' : ''}}" bindtap="setItemFilter" data-filter="material">ææ–™</view>
        <view class="filter-item {{itemFilter === 'consumable' ? 'active' : ''}}" bindtap="setItemFilter" data-filter="consumable">æ¶ˆè€—</view>
        <view class="filter-item {{itemFilter === 'resource' ? 'active' : ''}}" bindtap="setItemFilter" data-filter="resource">èµ„æº</view>
      </view>
    </view>
    
    <!-- ä¸­é—´ï¼šä»“åº“ç½‘æ ¼ -->
    <view class="grid-panel">
      <scroll-view class="grid-scroll" scroll-y>
        <!-- è£…å¤‡ç½‘æ ¼ -->
        <view class="storage-grid" wx:if="{{activeTab === 'equipment'}}">
          <!-- å·²æœ‰è£…å¤‡ -->
          <view class="grid-slot {{item.qualityClass}} {{selectedEquipments.indexOf(item.id) > -1 ? 'selected' : ''}}" 
                wx:for="{{equipments}}" wx:key="id"
                bindtap="onEquipmentTap" data-id="{{item.id}}" data-index="{{index}}">
            <view class="slot-bg"></view>
            <view class="slot-content">
              <text class="slot-icon">{{item.icon || 'ğŸ—¡ï¸'}}</text>
              <text class="slot-level" wx:if="{{item.enhanceLevel > 0}}">+{{item.enhanceLevel}}</text>
              <view class="select-mark" wx:if="{{batchMode && selectedEquipments.indexOf(item.id) > -1}}">âœ“</view>
            </view>
            <text class="slot-name">{{item.name}}</text>
          </view>
          <!-- ç©ºæ ¼å­ -->
          <view class="grid-slot empty" wx:for="{{emptyEquipmentSlots}}" wx:key="*this">
            <view class="slot-bg"></view>
            <view class="slot-content">
              <text class="empty-icon">+</text>
            </view>
          </view>
        </view>
        
        <!-- ç‰©å“ç½‘æ ¼ -->
        <view class="storage-grid" wx:if="{{activeTab === 'item'}}">
          <!-- å·²æœ‰ç‰©å“ -->
          <view class="grid-slot {{item.qualityClass}}" 
                wx:for="{{items}}" wx:key="itemId"
                bindtap="onItemTap" data-item="{{item}}">
            <view class="slot-bg"></view>
            <view class="slot-content">
              <text class="slot-icon">{{item.icon || 'ğŸ“¦'}}</text>
              <text class="slot-count">{{item.count}}</text>
            </view>
            <text class="slot-name">{{item.name}}</text>
          </view>
          <!-- ç©ºæ ¼å­ -->
          <view class="grid-slot empty" wx:for="{{emptyItemSlots}}" wx:key="*this">
            <view class="slot-bg"></view>
            <view class="slot-content">
              <text class="empty-icon">+</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
    
    <!-- å³ä¾§ï¼šè¯¦æƒ…é¢æ¿ -->
    <view class="detail-panel" wx:if="{{selectedItem}}">
      <view class="detail-header">
        <view class="detail-icon-wrap {{selectedItem.qualityClass}}">
          <text class="detail-icon">{{selectedItem.icon || 'ğŸ“¦'}}</text>
        </view>
        <view class="detail-title">
          <text class="detail-name">{{selectedItem.name}}</text>
          <text class="detail-quality">{{selectedItem.qualityName || 'æ™®é€š'}}</text>
        </view>
        <view class="close-btn" bindtap="closeDetail">âœ•</view>
      </view>
      
      <view class="detail-body">
        <!-- è£…å¤‡è¯¦æƒ… -->
        <block wx:if="{{selectedItem.isEquipment}}">
          <view class="attr-section">
            <view class="attr-title">å±æ€§åŠ æˆ</view>
            <view class="attr-grid">
              <view class="attr-item" wx:if="{{selectedItem.attack}}">
                <text class="attr-label">æ”»å‡»</text>
                <text class="attr-value">+{{selectedItem.attack}}</text>
              </view>
              <view class="attr-item" wx:if="{{selectedItem.defense}}">
                <text class="attr-label">é˜²å¾¡</text>
                <text class="attr-value">+{{selectedItem.defense}}</text>
              </view>
              <view class="attr-item" wx:if="{{selectedItem.valor}}">
                <text class="attr-label">æ­¦å‹‡</text>
                <text class="attr-value">+{{selectedItem.valor}}</text>
              </view>
              <view class="attr-item" wx:if="{{selectedItem.command}}">
                <text class="attr-label">ç»Ÿå¾¡</text>
                <text class="attr-value">+{{selectedItem.command}}</text>
              </view>
              <view class="attr-item" wx:if="{{selectedItem.mobility}}">
                <text class="attr-label">æœºåŠ¨</text>
                <text class="attr-value">+{{selectedItem.mobility}}</text>
              </view>
            </view>
          </view>
          
          <view class="desc-section">
            <text>{{selectedItem.description || 'ä¸€ä»¶è£…å¤‡'}}</text>
          </view>
          
          <view class="btn-section">
            <view class="detail-btn equip" bindtap="equipItem">è£…å¤‡</view>
            <view class="detail-btn sell" bindtap="sellEquipment">å‡ºå”® {{selectedItem.sellPrice}}é“¶</view>
          </view>
        </block>
        
        <!-- ç‰©å“è¯¦æƒ… -->
        <block wx:else>
          <view class="count-section">
            <text>æ•°é‡: {{selectedItem.count}} / {{selectedItem.maxStack || 99}}</text>
          </view>
          
          <view class="desc-section">
            <text>{{selectedItem.description || 'ä¸€ä»¶ç‰©å“'}}</text>
          </view>
          
          <view class="btn-section">
            <view class="detail-btn use" bindtap="useItem" wx:if="{{selectedItem.usable}}">ä½¿ç”¨</view>
            <view class="detail-btn discard" bindtap="discardItem">ä¸¢å¼ƒ</view>
          </view>
        </block>
      </view>
    </view>
    
    <!-- æ— é€‰ä¸­æ—¶çš„æç¤º -->
    <view class="hint-panel" wx:if="{{!selectedItem}}">
      <text class="hint-icon">ğŸ‘†</text>
      <text class="hint-text">ç‚¹å‡»ç‰©å“æŸ¥çœ‹è¯¦æƒ…</text>
    </view>
  </view>
</view>
